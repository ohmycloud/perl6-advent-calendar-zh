# [Day 10 â€“ Wrapping Rats](https://perl6advent.wordpress.com/2017/12/10/day-10-wrapping-rats/)

æ²¿ç€çƒŸå›±å‘ä¸‹æ˜¯ä¸€ä»¶å±é™©çš„äº‹æƒ…ã€‚

çƒŸå›±å¯èƒ½å¾ˆçª„ï¼Œå¾ˆé«˜ï¼Œæœ‰æ—¶å€™å»ºé€ å¾—ä¸å¤Ÿå¥½ã€‚

ä»Šå¹´ï¼Œåœ£è¯è€äººæƒ³è¦åšå¥½å‡†å¤‡ã€‚å› æ­¤ï¼Œä»–æ­£åœ¨å°†çƒŸå›±æ£€æŸ¥ä¸äº¤ä»˜ç¤¼ç‰©ç»“åˆèµ·æ¥ã€‚

çƒŸå›±æ£€æŸ¥æ¶‰åŠç¡®ä¿æ¯å±‚ç –éƒ½å¤„äºæ­£ç¡®çš„é«˜åº¦; å³ç ‚æµ†å±‚çš„é«˜åº¦æ˜¯ä¸€è‡´çš„ï¼Œå¹¶ä¸”ç –çš„é«˜åº¦ä¹Ÿæ˜¯ä¸€è‡´çš„ã€‚

ä¾‹å¦‚ï¼Œå¯¹äº 2Â¼â€ é«˜çš„ç –å’Œåšåº¦ä¸º â…œâ€ çš„ç ‚æµ†ï¼Œæµ‹é‡åºåˆ—åº”è¯¥å¦‚ä¸‹æ‰€ç¤ºï¼š

```
                       ğŸ… 
                      â”€â–ˆâ–ˆâ”€
                       ||
 layer                                      total
       â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘ â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘ â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘
  2Â¼   â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘ â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘ â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘
       â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘ â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘ â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘
   â…œ                                        â€¾â€¾???
       â–‘â–‘â–‘â–‘â–‘ â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘ â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘ â–‘â–‘â–‘â–‘
  2Â¼   â–‘â–‘â–‘â–‘â–‘ â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘ â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘ â–‘â–‘â–‘â–‘
       â–‘â–‘â–‘â–‘â–‘ â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘ â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘ â–‘â–‘â–‘â–‘
   â…œ                                        â€¾â€¾5â…
       â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘ â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘ â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘
  2Â¼   â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘ â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘ â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘ 
       â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘ â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘ â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘
   â…œ                                        â€¾â€¾3
       â–‘â–‘â–‘â–‘â–‘â–‘ â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘ â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘ â–‘â–‘â–‘
  2Â¼   â–‘â–‘â–‘â–‘â–‘â–‘ â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘ â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘ â–‘â–‘â–‘ 
       â–‘â–‘â–‘â–‘â–‘â–‘ â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘ â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘ â–‘â–‘â–‘
   â…œ   _____________________________________â€¾â€¾â…œ 
```

è¿™ä¸ªè®¡åˆ’æ˜¯è®©ç²¾çµä»¬ä¸‹é™åˆ°çƒŸå›±çš„åº•éƒ¨ï¼Œæ‰‹ä¸­æ‹¿ç€å·å°ºï¼Œç„¶åå›æ¥ï¼Œç¡®ä¿æ¯ä¸ªç –å—çš„é¡¶éƒ¨æ°å¥½ä½äºå·å°ºä¸Šçš„æ­£ç¡®ä½ç½®ã€‚

ä¸€ä¸ªåå«çŒ«ç‹çš„ç‰¹æ®Šç²¾çµå·²ç»è‡ªå·±å†™äº†ä¸€ä¸ªç¨‹åºæ¥å¸®åŠ©å®Œæˆè®¡ç®—è¿™ä¸ªé«˜åº¦åºåˆ—çš„ä»»åŠ¡ã€‚

å› ä¸ºæ‡’æƒ°ï¼ŒçŒ«ç‹ç”šè‡³ä¸æƒ³æ·»åŠ ä¸Šè¿°ä»»ä½•åˆ†æ•°ï¼Œå¹¶å¸Œæœ›ç¨‹åºå®Œæˆæ‰€æœ‰å·¥ä½œã€‚ä»–ä¹Ÿä¸æƒ³èŠ±è´¹ç²¾åŠ›å»æ‰¾å‡ºæ¯å±‚é«˜åº¦çš„å…¬å¼ã€‚å¹¸è¿çš„æ˜¯ï¼Œä»–æ­£åœ¨ä½¿ç”¨ Perl 6ï¼Œå®ƒå°† unicode åˆ†æ•°è½¬æ¢ä¸ºæœ‰ç†æ•°ï¼ˆç±»å‹ä¸º `Rat`ï¼‰ï¼Œå¹¶ä¸”è¿˜æœ‰ä¸€ä¸ªåºåˆ—è¿ç®—ç¬¦ï¼ˆ`...`ï¼‰ï¼Œå®ƒæ ¹æ®å‰å‡ é¡¹è®¡ç®—å‡ºç®—æœ¯åºåˆ—ã€‚

æ‰€ä»¥ï¼ŒçŒ«ç‹åœ¨ç¨‹åºä¸­çš„ç¬¬ä¸€ä¸ªç‰‡æ®µçœ‹èµ·æ¥åƒè¿™æ ·ï¼š

```perl6
my @heights = 0, â…œ, 3, 5+â… ... *;

say @heights[^10].join(', ')
```

è¿™ç»™äº†ä»–éœ€è¦çš„å‰10ä¸ªé«˜åº¦ï¼š

```
0, 0.375, 3, 5.625, 8.25, 10.875, 13.5, 16.125, 18.75, 21.375
```

è™½ç„¶è¿™æ˜¯æ­£ç¡®çš„ï¼Œä½†å¾ˆéš¾ä½¿ç”¨ã€‚å·å°ºåªæœ‰å‡ åˆ†ä¹‹ä¸€è‹±å¯¸ï¼Œè€Œä¸æ˜¯å°æ•°ã€‚çŒ«ç‹çœŸæ­£æƒ³è¦çš„è¾“å‡ºæ˜¯åˆ†æ•°ã€‚

å¹¸è¿çš„æ˜¯ï¼Œä»–çŸ¥é“ä½¿ç”¨ `join` å°† `Rat`s è½¬æ¢ä¸ºå­—ç¬¦ä¸²ï¼Œé€šè¿‡è°ƒç”¨ `Rat` ç±»çš„ `Str` æ–¹æ³•å®Œæˆå°† `Rat` è½¬æ¢ä¸º `Str`ã€‚å› æ­¤ï¼Œé€šè¿‡ä¿®æ”¹ `Rat.Str` çš„è¡Œä¸ºï¼Œä»–è®¤ä¸ºå¯ä»¥ä½¿è¾“å‡ºæ›´æ¼‚äº®ã€‚

ä»–å†³å®šè¿™æ ·åšçš„æ–¹å¼æ˜¯åŒ…è£…(`wrap`) `Str` æ–¹æ³•ï¼ˆåˆåä½¿ç”¨è£…é¥°å™¨æ¨¡å¼ï¼‰ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š

```perl6
Rat.^find_method('Str').wrap:
  sub ($r) {
    my $whole = $r.Int || "";
    my $frac = $r - $whole;
    return "$whole" unless $frac > 0;
    return "$whole" ~ <â…› Â¼ â…œ Â½ â… Â¾ â…>[$frac * 8 - 1];
  }
```

æ¢å¥è¯è¯´ï¼Œå½“æŠŠ `Rat` å­—ç¬¦ä¸²åŒ–æ—¶ï¼Œé™¤éæœ‰å°æ•°éƒ¨åˆ†ï¼Œå¦åˆ™è¿”å›æ•´ä¸ªéƒ¨åˆ†ã€‚ç„¶åå°†å°æ•°éƒ¨åˆ†è§†ä¸ºå…«åˆ†ä¹‹ä¸€æ•°ï¼Œå¹¶å°†å…¶ç”¨ä½œæ•°ç»„ä¸­çš„ç´¢å¼•ä»¥æŸ¥æ‰¾æ­£ç¡®çš„ unicode åˆ†æ•°ã€‚

ä»–å°†è¿™ä¸€ç‚¹ä¸ä»–çš„ç¬¬ä¸€ä¸ªç¨‹åºç»“åˆèµ·æ¥ï¼Œä»¥è·å¾—è¿™æ ·çš„é«˜åº¦ï¼š

```
0, â…œ, 3, 5â…, 8Â¼, 10â…, 13Â½, 16â…›, 18Â¾, 21â…œ
```

â€œä¸‡å²!â€ ä»–æƒ³ã€‚ â€œæ­£æ˜¯æˆ‘éœ€è¦çš„ã€‚â€

åœ£è¯è€äººçœ‹äº†çœ‹è¿™ä¸ªç¨‹åºï¼Œå¹¶è¯´ï¼šâ€œçŒ«ç‹ï¼Œè¿™å¾ˆèªæ˜ï¼Œä½†è¿˜ä¸å¤Ÿã€‚è™½ç„¶å¤§å¤šæ•°ç –å—çš„å°ºå¯¸æ˜¯ â…› çš„å€æ•°ï¼Œä½†ç ‚æµ†æ°´å¹³å¯èƒ½å¹¶éå¦‚æ­¤ã€‚ä½ ä¹Ÿå¯ä»¥è®©ä½ çš„ç¨‹åºå¤„ç†è¿™äº›æƒ…å†µå—ï¼Ÿâ€œ

â€œå½“ç„¶â€ï¼ŒçŒ«ç‹è‹¦ç¬‘ç€è¯´ã€‚ç„¶åä»–å°†è¿™ä¸€è¡Œæ·»åŠ åˆ°ä»–çš„åŒ…è£…å‡½æ•°ä¸­ï¼š

```perl6
return "$whole {$frac.numerator}â„{$frac.denominator}"
   unless $frac %% â…›;
```

ä½¿ç”¨â€œå¯è¢«æ•´é™¤â€æ“ä½œç¬¦ï¼ˆ`%%`ï¼‰ï¼Œä»¥ç¡®ä¿åˆ†æ•°å¯ä»¥å¹³åˆ†ä¸ºå…«åˆ†ä¹‹ä¸€ï¼Œå¹¶ä¸”å¦‚æœä¸æ˜¯åªæ˜¾å¼åœ°æ‰“å°åˆ†å­å’Œåˆ†æ¯ã€‚ç„¶åï¼Œå¯¹äº â…•â€ åšçš„ç ‚æµ†ï¼Œåºåˆ—ä¸ºï¼š

```perl6
my @heights = 0, â…•,
                 â…• + 2+Â¼ + â…•,
                 â…• + 2+Â¼ + â…•
                   + 2+Â¼ + â…• ... *;
say @heights[^10].join(', ');
```

```
0,  1â„5, 2 13â„20, 5 1â„10, 7 11â„20, 10, 12 9â„20, 14 9â„10, 17 7â„20, 19 4â„5
```

â€œå®é™…ä¸Šâ€ï¼Œåœ£è¯è€äººè¯´ï¼Œâ€œç°åœ¨åœ¨æˆ‘çœ‹æ¥ï¼Œä¹Ÿè®¸è¿™æ²¡æœ‰ç”¨ - å·å°ºåªæœ‰åå…­åˆ†ä¹‹ä¸€è‹±å¯¸ï¼Œæ‰€ä»¥æœ€å¥½å››èˆäº”å…¥åˆ°åå…­åˆ†ä¹‹ä¸€è‹±å¯¸ã€‚â€

![img](https://perl6advent.files.wordpress.com/2017/12/tape-measure.jpg?w=1570)

çŒ«ç‹åŠ äº†ä¸€ä¸ª `round` è°ƒç”¨æ¥ç»“æŸï¼š

```perl6
Rat.^find_method('Str').wrap:
  sub ($r) {
        my $whole = $r.Int || '';
        my $frac = $r - $whole;
        return "$whole" unless $frac > 0;
        my $rounded = ($frac * 16).round/16;
        return "$whole" ~ <â…› Â¼ â…œ Â½ â… Â¾ â…>[$frac * 8 - 1] if $rounded %% â…›;
        return "$whole {$rounded.numerator}â„{$rounded.denominator}";
  }
```

è¿™ç»™äº†ä»–ï¼š

```
0,  3â„16, 2â…, 5â…›, 7 9â„16, 10, 12 7â„16, 14â…, 17Â¼, 19 13â„16
```

ä»–å‘ Elvira ç²¾çµå±•ç¤ºäº†ä»–çš„ç¨‹åºï¼Œä»–è¯´ï¼šâ€œçœŸæ˜¯å·§åˆï¼Œæˆ‘å†™äº†ä¸€ä¸ªå‡ ä¹å®Œå…¨ä¸€æ ·çš„ç¨‹åºï¼é™¤æ­¤ä¹‹å¤–ï¼Œæˆ‘ä¹Ÿæƒ³çŸ¥é“ç –å±‚çš„åº•éƒ¨åœ¨å“ªé‡Œã€‚æˆ‘æ— æ³•ä½¿ç”¨åºåˆ—è¿ç®—ç¬¦æ¥å®Œæˆæ­¤æ“ä½œï¼Œå› ä¸ºå®ƒä¸æ˜¯ç®—æœ¯çº§æ•°ï¼Œä½†æ˜¯æˆ‘å¯ä»¥ä½¿ç”¨ lazy gather å’ŒåŒ¿åæœ‰çŠ¶æ€å˜é‡ï¼å°±åƒè¿™æ ·ï¼š

```perl6
my \brick = 2 + Â¼;
my \mortar = â…œ;
my @heights = lazy gather {
    take 0;
    loop { take $ += $_ for mortar, brick }
}
```

Elvira çš„ç¨‹åºäº§ç”Ÿäº†ï¼š

```
0, â…œ, 2â…, 3, 5Â¼, 5â…, 7â…, 8Â¼, 10Â½, 10â…
```

å³ç –å±‚çš„é¡¶éƒ¨å’Œåº•éƒ¨ï¼š

```
                     \ ğŸ… /
                       â–ˆâ–ˆ
                       ||
 layer                                      total
       â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘ â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘ â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘
  2Â¼   â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘ â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘ â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘
       â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘ â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘ â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘
   â…œ                                        â€¾â€¾8Â¼
       â–‘â–‘â–‘â–‘â–‘ â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘ â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘ â–‘â–‘â–‘â–‘â€¾â€¾7â…
  2Â¼   â–‘â–‘â–‘â–‘â–‘ â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘ â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘ â–‘â–‘â–‘â–‘
       â–‘â–‘â–‘â–‘â–‘ â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘ â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘ â–‘â–‘â–‘â–‘
   â…œ                                        â€¾â€¾5â…
       â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘ â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘ â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â€¾â€¾5Â¼
  2Â¼   â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘ â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘ â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘ 
       â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘ â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘ â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘
   â…œ                                        â€¾â€¾3
       â–‘â–‘â–‘â–‘â–‘â–‘ â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘ â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘ â–‘â–‘â–‘â€¾â€¾2â…
  2Â¼   â–‘â–‘â–‘â–‘â–‘â–‘ â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘ â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘ â–‘â–‘â–‘ 
       â–‘â–‘â–‘â–‘â–‘â–‘ â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘ â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘ â–‘â–‘â–‘
   â…œ   _____________________________________â€¾â€¾â…œ
                                            â€¾â€¾0
```

æœ‰äº†ä»–ä»¬çš„ç¨‹åºåœ¨æ‰‹ï¼Œç²¾çµæ£€æŸ¥äº†çƒŸå›±ï¼Œåœ£è¯è€äººåœ¨å¦ä¸€ä¸ªèŠ‚æ—¥æœŸé—´æ²¡æœ‰å—ä¼¤ã€‚
